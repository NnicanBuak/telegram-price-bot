<?xml version="1.0" encoding="utf-8"?><testsuites name="pytest tests"><testsuite name="pytest" errors="0" failures="18" skipped="0" tests="97" time="3.969" timestamp="2025-08-09T23:01:04.278780+08:00" hostname="DESKTOP-L3VL5UE"><testcase classname="tests.test_bot.TestConfig" name="test_config_loading" file="tests\test_bot.py" line="28" time="0.189"><failure message="AssertionError: assert '1234567890:A...MMNNOOPP-TEST' == '1234567890:A...MMNNOOPP-FAKE'&#10;  &#10;  #x1B[0m#x1B[91m- 1234567890:AABBCCDDEEFFGGHHIIJJKKLLMMNNOOPP-FAKE#x1B[39;49;00m#x1B[90m#x1B[39;49;00m&#10;  ?                                             ^^^#x1B[90m#x1B[39;49;00m&#10;  #x1B[92m+ 1234567890:AABBCCDDEEFFGGHHIIJJKKLLMMNNOOPP-TEST#x1B[39;49;00m#x1B[90m#x1B[39;49;00m&#10;  ?                                             ^ ++#x1B[90m#x1B[39;49;00m">self = &lt;tests.test_bot.TestConfig object at 0x000002B0B2111590&gt;

    def test_config_loading(self):
        """Тест загрузки конфигурации"""
        config = Config()
&gt;       assert config.bot_token == "1234567890:AABBCCDDEEFFGGHHIIJJKKLLMMNNOOPP-FAKE"
E       AssertionError: assert '1234567890:A...MMNNOOPP-TEST' == '1234567890:A...MMNNOOPP-FAKE'
E         
E         #x1B[0m#x1B[91m- 1234567890:AABBCCDDEEFFGGHHIIJJKKLLMMNNOOPP-FAKE#x1B[39;49;00m#x1B[90m#x1B[39;49;00m
E         ?                                             ^^^#x1B[90m#x1B[39;49;00m
E         #x1B[92m+ 1234567890:AABBCCDDEEFFGGHHIIJJKKLLMMNNOOPP-TEST#x1B[39;49;00m#x1B[90m#x1B[39;49;00m
E         ?                                             ^ ++#x1B[90m#x1B[39;49;00m

tests\test_bot.py:32: AssertionError</failure></testcase><testcase classname="tests.test_bot.TestConfig" name="test_config_validation" file="tests\test_bot.py" line="36" time="0.004"><failure message="Failed: DID NOT RAISE &lt;class 'ValueError'&gt;">self = &lt;tests.test_bot.TestConfig object at 0x000002B0B2111A90&gt;

    def test_config_validation(self):
        """Тест валидации конфигурации"""
        with patch.dict(os.environ, {"BOT_TOKEN": ""}):
&gt;           with pytest.raises(ValueError, match="BOT_TOKEN"):
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           Failed: DID NOT RAISE &lt;class 'ValueError'&gt;

tests\test_bot.py:40: Failed</failure></testcase><testcase classname="tests.test_bot.TestDatabase" name="test_create_template" file="tests\test_bot.py" line="57" time="0.076" /><testcase classname="tests.test_bot.TestDatabase" name="test_create_template_with_file" file="tests\test_bot.py" line="69" time="0.028" /><testcase classname="tests.test_bot.TestDatabase" name="test_get_templates" file="tests\test_bot.py" line="82" time="0.040" /><testcase classname="tests.test_bot.TestDatabase" name="test_create_chat_group" file="tests\test_bot.py" line="93" time="0.027" /><testcase classname="tests.test_bot.TestDatabase" name="test_create_mailing" file="tests\test_bot.py" line="105" time="0.042" /><testcase classname="tests.test_bot.TestMenuSystem" name="test_menu_manager_initialization" file="tests\test_bot.py" line="129" time="0.001" /><testcase classname="tests.test_bot.TestMenuSystem" name="test_is_admin" file="tests\test_bot.py" line="135" time="0.001" /><testcase classname="tests.test_bot.TestMenuSystem" name="test_register_menu" file="tests\test_bot.py" line="141" time="0.002" /><testcase classname="tests.test_bot.TestMenuSystem" name="test_menu_navigation" file="tests\test_bot.py" line="149" time="0.002" /><testcase classname="tests.test_bot.TestMenuSystem" name="test_build_keyboard" file="tests\test_bot.py" line="163" time="0.002" /><testcase classname="tests.test_bot.TestBotMenus" name="test_bot_menus_initialization" file="tests\test_bot.py" line="202" time="0.002" /><testcase classname="tests.test_bot.TestBotMenus" name="test_main_menu_structure" file="tests\test_bot.py" line="212" time="0.002"><failure message="KeyError: 'main'">self = &lt;tests.test_bot.TestBotMenus object at 0x000002B0B2111F90&gt;, menu_manager = &lt;menu_system.MenuManager object at 0x000002B0B23D47C0&gt;

    def test_main_menu_structure(self, menu_manager):
        """Тест структуры главного меню"""
&gt;       main_menu = menu_manager.menus["main"]
                    ^^^^^^^^^^^^^^^^^^^^^^^^^^
E       KeyError: 'main'

tests\test_bot.py:215: KeyError</failure></testcase><testcase classname="tests.test_bot.TestBotMenus" name="test_templates_list_menu_creation" file="tests\test_bot.py" line="222" time="0.046" /><testcase classname="tests.test_bot.TestBotMenus" name="test_groups_list_menu_creation" file="tests\test_bot.py" line="231" time="0.046" /><testcase classname="tests.test_bot.TestBotMenus" name="test_mailing_template_selection_menu" file="tests\test_bot.py" line="240" time="0.044" /><testcase classname="tests.test_bot.TestBotMenus" name="test_empty_templates_menu" file="tests\test_bot.py" line="248" time="0.023" /><testcase classname="tests.test_bot.TestIntegration" name="test_full_menu_workflow" file="tests\test_bot.py" line="263" time="0.034" /><testcase classname="tests.test_bot.TestIntegration" name="test_menu_rendering" file="tests\test_bot.py" line="286" time="0.003" /><testcase classname="tests.test_bot.TestIntegration" name="test_access_control" file="tests\test_bot.py" line="300" time="0.004" /><testcase classname="tests.test_config.TestSmartConfig" name="test_automatic_test_mode_detection" file="tests\test_config.py" line="14" time="0.002" /><testcase classname="tests.test_config.TestSmartConfig" name="test_test_token_usage" file="tests\test_config.py" line="23" time="0.003" /><testcase classname="tests.test_config.TestSmartConfig" name="test_production_token_usage" file="tests\test_config.py" line="40" time="0.005"><failure message="AssertionError: assert 'test_token' == 'prod_token'&#10;  &#10;  #x1B[0m#x1B[91m- prod_token#x1B[39;49;00m#x1B[90m#x1B[39;49;00m&#10;  #x1B[92m+ test_token#x1B[39;49;00m#x1B[90m#x1B[39;49;00m">self = &lt;tests.test_config.TestSmartConfig object at 0x000002B0B214DA70&gt;

    def test_production_token_usage(self):
        """Тест использования продакшн токена"""
        with patch.dict(
            os.environ,
            {
                "BOT_TOKEN": "prod_token",
                "TEST_BOT_TOKEN": "test_token",
                "ENVIRONMENT": "production",
            },
        ):
            config = Config()
    
            # В продакшене должен использоваться BOT_TOKEN
&gt;           assert config.bot_token == "prod_token"
E           AssertionError: assert 'test_token' == 'prod_token'
E             
E             #x1B[0m#x1B[91m- prod_token#x1B[39;49;00m#x1B[90m#x1B[39;49;00m
E             #x1B[92m+ test_token#x1B[39;49;00m#x1B[90m#x1B[39;49;00m

tests\test_config.py:54: AssertionError</failure></testcase><testcase classname="tests.test_config.TestSmartConfig" name="test_fallback_to_main_token" file="tests\test_config.py" line="57" time="0.004" /><testcase classname="tests.test_config.TestSmartConfig" name="test_test_admin_ids" file="tests\test_config.py" line="74" time="0.004" /><testcase classname="tests.test_config.TestSmartConfig" name="test_test_database_settings" file="tests\test_config.py" line="89" time="0.001" /><testcase classname="tests.test_config.TestSmartConfig" name="test_test_mailing_settings" file="tests\test_config.py" line="97" time="0.002"><failure message="assert 0.1 == 0.0&#10; +  where 0.1 = &lt;config.Config object at 0x000002B0B2457E50&gt;.mailing_delay">self = &lt;tests.test_config.TestSmartConfig object at 0x000002B0B2115D00&gt;

    def test_test_mailing_settings(self):
        """Тест настроек рассылки для тестов"""
        config = Config()
    
        # В тестах рассылка должна быть ускорена
&gt;       assert config.mailing_delay == 0.0  # Без задержки
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       assert 0.1 == 0.0
E        +  where 0.1 = &lt;config.Config object at 0x000002B0B2457E50&gt;.mailing_delay

tests\test_config.py:103: AssertionError</failure></testcase><testcase classname="tests.test_config.TestSmartConfig" name="test_environment_detection_methods" file="tests\test_config.py" line="106" time="0.006"><failure message="assert True is False&#10; +  where True = &lt;config.Config object at 0x000002B0B25CDC70&gt;.is_testing">self = &lt;tests.test_config.TestSmartConfig object at 0x000002B0B212A150&gt;

    def test_environment_detection_methods(self):
        """Тест методов определения окружения"""
        # Тестовое окружение
        with patch.dict(os.environ, {"ENVIRONMENT": "testing"}):
            config = Config()
            assert config.is_testing is True
            assert config.is_development is False
            assert config.is_production is False
            assert config.debug_mode is True
    
        # Продакшн окружение
        with patch.dict(os.environ, {"ENVIRONMENT": "production", "DEBUG": "false"}):
            config = Config()
&gt;           assert config.is_testing is False
E           assert True is False
E            +  where True = &lt;config.Config object at 0x000002B0B25CDC70&gt;.is_testing

tests\test_config.py:120: AssertionError</failure></testcase><testcase classname="tests.test_config.TestSmartConfig" name="test_pytest_detection" file="tests\test_config.py" line="132" time="0.004" /><testcase classname="tests.test_config.TestSmartConfig" name="test_config_string_representation" file="tests\test_config.py" line="139" time="0.002" /><testcase classname="tests.test_config.TestSmartConfig" name="test_missing_tokens_error" file="tests\test_config.py" line="155" time="0.006" /><testcase classname="tests.test_config.TestSmartConfig" name="test_missing_admin_ids_error" file="tests\test_config.py" line="162" time="0.004" /><testcase classname="tests.test_database.TestTemplateOperations" name="test_create_template_minimal" file="tests\test_database.py" line="59" time="0.026" /><testcase classname="tests.test_database.TestTemplateOperations" name="test_create_template_with_file" file="tests\test_database.py" line="74" time="0.027" /><testcase classname="tests.test_database.TestTemplateOperations" name="test_create_template_with_photo" file="tests\test_database.py" line="87" time="0.026" /><testcase classname="tests.test_database.TestTemplateOperations" name="test_get_template_by_id" file="tests\test_database.py" line="99" time="0.027" /><testcase classname="tests.test_database.TestTemplateOperations" name="test_get_nonexistent_template" file="tests\test_database.py" line="111" time="0.022" /><testcase classname="tests.test_database.TestTemplateOperations" name="test_get_all_templates" file="tests\test_database.py" line="117" time="0.072" /><testcase classname="tests.test_database.TestTemplateOperations" name="test_update_template" file="tests\test_database.py" line="129" time="0.069" /><testcase classname="tests.test_database.TestTemplateOperations" name="test_update_nonexistent_template" file="tests\test_database.py" line="148" time="0.023" /><testcase classname="tests.test_database.TestTemplateOperations" name="test_delete_template" file="tests\test_database.py" line="154" time="0.032" /><testcase classname="tests.test_database.TestTemplateOperations" name="test_delete_nonexistent_template" file="tests\test_database.py" line="168" time="0.023" /><testcase classname="tests.test_database.TestChatGroupOperations" name="test_create_chat_group" file="tests\test_database.py" line="178" time="0.023" /><testcase classname="tests.test_database.TestChatGroupOperations" name="test_create_empty_chat_group" file="tests\test_database.py" line="193" time="0.026" /><testcase classname="tests.test_database.TestChatGroupOperations" name="test_get_chat_group_by_id" file="tests\test_database.py" line="200" time="0.028" /><testcase classname="tests.test_database.TestChatGroupOperations" name="test_get_all_chat_groups" file="tests\test_database.py" line="212" time="0.072" /><testcase classname="tests.test_database.TestChatGroupOperations" name="test_get_chat_groups_by_ids" file="tests\test_database.py" line="224" time="0.078" /><testcase classname="tests.test_database.TestChatGroupOperations" name="test_update_chat_group" file="tests\test_database.py" line="239" time="0.032" /><testcase classname="tests.test_database.TestChatGroupOperations" name="test_delete_chat_group" file="tests\test_database.py" line="252" time="0.032" /><testcase classname="tests.test_database.TestMailingOperations" name="test_create_mailing" file="tests\test_database.py" line="268" time="0.077" /><testcase classname="tests.test_database.TestMailingOperations" name="test_update_mailing_stats" file="tests\test_database.py" line="288" time="0.082" /><testcase classname="tests.test_database.TestMailingOperations" name="test_get_mailings_history" file="tests\test_database.py" line="308" time="0.092" /><testcase classname="tests.test_database.TestMailingOperations" name="test_get_mailings_history_with_limit" file="tests\test_database.py" line="327" time="0.123" /><testcase classname="tests.test_integration.TestFullWorkflow" name="test_complete_mailing_workflow" file="tests\test_integration.py" line="42" time="0.068" /><testcase classname="tests.test_integration.TestFullWorkflow" name="test_menu_navigation_workflow" file="tests\test_integration.py" line="102" time="0.022"><failure message="AssertionError: assert 'Бот для рассылки прайс-листов' in '❌ Меню не найдено или нет доступа'">self = &lt;tests.test_integration.TestFullWorkflow object at 0x000002B0B2113390&gt;
test_environment = (&lt;config.Config object at 0x000002B0B255C590&gt;, &lt;database.database.Database object at 0x000002B0B29FB710&gt;, &lt;menu_system.MenuManager object at 0x000002B0B2759A90&gt;)

    @pytest.mark.asyncio
    async def test_menu_navigation_workflow(self, test_environment):
        """Тест навигации по меню"""
        config, db, menu_manager = test_environment
    
        admin_id = 123456789
    
        # Начальное меню
        text, keyboard = menu_manager.render_menu("main", admin_id)
&gt;       assert "Бот для рассылки прайс-листов" in text
E       AssertionError: assert 'Бот для рассылки прайс-листов' in '❌ Меню не найдено или нет доступа'

tests\test_integration.py:112: AssertionError</failure></testcase><testcase classname="tests.test_integration.TestFullWorkflow" name="test_access_control_workflow" file="tests\test_integration.py" line="133" time="0.019"><failure message="assert None is not None">self = &lt;tests.test_integration.TestFullWorkflow object at 0x000002B0B214E8B0&gt;
test_environment = (&lt;config.Config object at 0x000002B0B2A29FD0&gt;, &lt;database.database.Database object at 0x000002B0B2A3E5D0&gt;, &lt;menu_system.MenuManager object at 0x000002B0B275A150&gt;)

    @pytest.mark.asyncio
    async def test_access_control_workflow(self, test_environment):
        """Тест контроля доступа"""
        config, db, menu_manager = test_environment
    
        admin_id = 123456789
        regular_user_id = 111111111
    
        # Админ имеет доступ
        admin_menu = menu_manager.get_menu("main", admin_id)
&gt;       assert admin_menu is not None
E       assert None is not None

tests\test_integration.py:144: AssertionError</failure></testcase><testcase classname="tests.test_integration.TestBotIntegration" name="test_bot_initialization" file="tests\test_integration.py" line="184" time="0.036"><failure message="ImportError: cannot import name 'bot' from 'src.main' (C:\Users\Nnican\Desktop\Projects\my_best_mailing_bot\src\main.py)">self = &lt;tests.test_integration.TestBotIntegration object at 0x000002B0B21134D0&gt;
test_environment = (&lt;config.Config object at 0x000002B0B2A2B690&gt;, &lt;database.database.Database object at 0x000002B0B2A3ECF0&gt;, &lt;menu_system.MenuManager object at 0x000002B0B27914F0&gt;)

    @pytest.mark.asyncio
    async def test_bot_initialization(self, test_environment):
        """Тест инициализации бота"""
        config, db, menu_manager = test_environment
    
        with patch("aiogram.Bot") as MockBot:
            mock_bot = MockBot.return_value
            mock_bot.get_me = AsyncMock(
                return_value=MagicMock(
                    id=123456789, username="test_bot", first_name="Test Bot"
                )
            )
    
            # Импортируем после патча
&gt;           from src.main import bot, dp
E           ImportError: cannot import name 'bot' from 'src.main' (C:\Users\Nnican\Desktop\Projects\my_best_mailing_bot\src\main.py)

tests\test_integration.py:199: ImportError</failure></testcase><testcase classname="tests.test_integration.TestBotIntegration" name="test_command_handlers" file="tests\test_integration.py" line="204" time="0.023"><failure message="ImportError: cannot import name 'cmd_start' from 'src.main' (C:\Users\Nnican\Desktop\Projects\my_best_mailing_bot\src\main.py)">self = &lt;tests.test_integration.TestBotIntegration object at 0x000002B0B2113610&gt;
test_environment = (&lt;config.Config object at 0x000002B0B2A8BA10&gt;, &lt;database.database.Database object at 0x000002B0B2A71CD0&gt;, &lt;menu_system.MenuManager object at 0x000002B0B2792AF0&gt;)

    @pytest.mark.asyncio
    async def test_command_handlers(self, test_environment):
        """Тест обработчиков команд"""
        config, db, menu_manager = test_environment
    
        # Создаем мок сообщения
        message = MagicMock(spec=types.Message)
        message.from_user = MagicMock()
        message.from_user.id = 123456789  # Admin
        message.chat = MagicMock()
        message.chat.id = 123456789
        message.chat.type = "private"
        message.answer = AsyncMock()
    
        # Тест команды /start
&gt;       from src.main import cmd_start
E       ImportError: cannot import name 'cmd_start' from 'src.main' (C:\Users\Nnican\Desktop\Projects\my_best_mailing_bot\src\main.py)

tests\test_integration.py:220: ImportError</failure></testcase><testcase classname="tests.test_integration.TestBotIntegration" name="test_callback_query_handling" file="tests\test_integration.py" line="237" time="0.022"><failure message="assert False is True">self = &lt;tests.test_integration.TestBotIntegration object at 0x000002B0B214E9E0&gt;
test_environment = (&lt;config.Config object at 0x000002B0B2AA92B0&gt;, &lt;database.database.Database object at 0x000002B0B2ABB590&gt;, &lt;menu_system.MenuManager object at 0x000002B0B2AC5450&gt;)

    @pytest.mark.asyncio
    async def test_callback_query_handling(self, test_environment):
        """Тест обработки callback query"""
        config, db, menu_manager = test_environment
    
        # Создаем мок callback query
        callback = MagicMock(spec=types.CallbackQuery)
        callback.from_user = MagicMock()
        callback.from_user.id = 123456789  # Admin
        callback.message = MagicMock()
        callback.message.edit_text = AsyncMock()
        callback.message.edit_reply_markup = AsyncMock()
        callback.answer = AsyncMock()
        callback.data = "menu_templates"
    
        # Навигация в меню шаблонов
        success = await menu_manager.navigate_to("templates", callback)
    
&gt;       assert success is True
E       assert False is True

tests\test_integration.py:256: AssertionError</failure></testcase><testcase classname="tests.test_integration.TestDatabaseIntegration" name="test_database_with_real_data" file="tests\test_integration.py" line="263" time="0.106" /><testcase classname="tests.test_integration.TestErrorHandling" name="test_database_connection_error" file="tests\test_integration.py" line="331" time="0.025" /><testcase classname="tests.test_integration.TestErrorHandling" name="test_invalid_bot_token" file="tests\test_integration.py" line="338" time="0.004"><failure message="assert 'Invalid token' in &quot;cannot import name 'bot' from 'src.main' (C:\\Users\\Nnican\\Desktop\\Projects\\my_best_mailing_bot\\src\\main.py)&quot;&#10; +  where &quot;cannot import name 'bot' from 'src.main' (C:\\Users\\Nnican\\Desktop\\Projects\\my_best_mailing_bot\\src\\main.py)&quot; = str(ImportError(&quot;cannot import name 'bot' from 'src.main' (C:\\Users\\Nnican\\Desktop\\Projects\\my_best_mailing_bot\\src\\main.py)&quot;))">self = &lt;tests.test_integration.TestErrorHandling object at 0x000002B0B21139D0&gt;

    @pytest.mark.asyncio
    async def test_invalid_bot_token(self):
        """Тест неверного токена бота"""
        os.environ["BOT_TOKEN"] = "invalid:token:format"
    
        with patch("aiogram.Bot") as MockBot:
            mock_bot = MockBot.return_value
            mock_bot.get_me = AsyncMock(side_effect=Exception("Invalid token"))
    
            try:
&gt;               from src.main import bot
E               ImportError: cannot import name 'bot' from 'src.main' (C:\Users\Nnican\Desktop\Projects\my_best_mailing_bot\src\main.py)

tests\test_integration.py:349: ImportError

During handling of the above exception, another exception occurred:

self = &lt;tests.test_integration.TestErrorHandling object at 0x000002B0B21139D0&gt;

    @pytest.mark.asyncio
    async def test_invalid_bot_token(self):
        """Тест неверного токена бота"""
        os.environ["BOT_TOKEN"] = "invalid:token:format"
    
        with patch("aiogram.Bot") as MockBot:
            mock_bot = MockBot.return_value
            mock_bot.get_me = AsyncMock(side_effect=Exception("Invalid token"))
    
            try:
                from src.main import bot
    
                bot_info = await bot.get_me()
                assert False, "Should raise exception"
            except Exception as e:
&gt;               assert "Invalid token" in str(e)
E               assert 'Invalid token' in "cannot import name 'bot' from 'src.main' (C:\\Users\\Nnican\\Desktop\\Projects\\my_best_mailing_bot\\src\\main.py)"
E                +  where "cannot import name 'bot' from 'src.main' (C:\\Users\\Nnican\\Desktop\\Projects\\my_best_mailing_bot\\src\\main.py)" = str(ImportError("cannot import name 'bot' from 'src.main' (C:\\Users\\Nnican\\Desktop\\Projects\\my_best_mailing_bot\\src\\main.py)"))

tests\test_integration.py:354: AssertionError</failure></testcase><testcase classname="tests.test_integration.TestErrorHandling" name="test_missing_admin_ids" file="tests\test_integration.py" line="355" time="0.003"><failure message="Failed: DID NOT RAISE &lt;class 'ValueError'&gt;">self = &lt;tests.test_integration.TestErrorHandling object at 0x000002B0B214EB10&gt;

    @pytest.mark.asyncio
    async def test_missing_admin_ids(self):
        """Тест отсутствия админских ID"""
        os.environ["BOT_TOKEN"] = "test:token"
        os.environ["ADMIN_IDS"] = ""
    
&gt;       with pytest.raises(ValueError, match="ADMIN_IDS"):
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E       Failed: DID NOT RAISE &lt;class 'ValueError'&gt;

tests\test_integration.py:362: Failed</failure></testcase><testcase classname="tests.test_integration.TestErrorHandling" name="test_menu_error_handling" file="tests\test_integration.py" line="364" time="0.023" /><testcase classname="tests.test_integration.TestPerformance" name="test_large_scale_operation" file="tests\test_integration.py" line="386" time="0.412" /><testcase classname="tests.test_menu_system.TestMenuItem" name="test_menu_item_creation" file="tests\test_menu_system.py" line="16" time="0.002" /><testcase classname="tests.test_menu_system.TestMenuItem" name="test_menu_item_defaults" file="tests\test_menu_system.py" line="34" time="0.002" /><testcase classname="tests.test_menu_system.TestMenu" name="test_menu_creation" file="tests\test_menu_system.py" line="54" time="0.001" /><testcase classname="tests.test_menu_system.TestMenu" name="test_add_item" file="tests\test_menu_system.py" line="70" time="0.001" /><testcase classname="tests.test_menu_system.TestMenu" name="test_remove_item" file="tests\test_menu_system.py" line="81" time="0.001" /><testcase classname="tests.test_menu_system.TestMenu" name="test_method_chaining" file="tests\test_menu_system.py" line="95" time="0.002" /><testcase classname="tests.test_menu_system.TestMenuManager" name="test_initialization" file="tests\test_menu_system.py" line="116" time="0.002"><failure message="AssertionError: assert 'main' in {}&#10; +  where {} = &lt;menu_system.MenuManager object at 0x000002B0B2B42750&gt;.menus">self = &lt;tests.test_menu_system.TestMenuManager object at 0x000002B0B21E82D0&gt;, manager = &lt;menu_system.MenuManager object at 0x000002B0B2B42750&gt;

    def test_initialization(self, manager):
        """Тест инициализации менеджера"""
        assert 123 in manager.admin_ids
        assert 456 in manager.admin_ids
        assert 789 in manager.admin_ids
    
        # Проверка стандартных меню
&gt;       assert "main" in manager.menus
E       AssertionError: assert 'main' in {}
E        +  where {} = &lt;menu_system.MenuManager object at 0x000002B0B2B42750&gt;.menus

tests\test_menu_system.py:124: AssertionError</failure></testcase><testcase classname="tests.test_menu_system.TestMenuManager" name="test_is_admin" file="tests\test_menu_system.py" line="128" time="0.001" /><testcase classname="tests.test_menu_system.TestMenuManager" name="test_register_menu" file="tests\test_menu_system.py" line="135" time="0.001" /><testcase classname="tests.test_menu_system.TestMenuManager" name="test_get_menu_access_control" file="tests\test_menu_system.py" line="143" time="0.002"><failure message="assert None is not None">self = &lt;tests.test_menu_system.TestMenuManager object at 0x000002B0B214F230&gt;, manager = &lt;menu_system.MenuManager object at 0x000002B0B2BC5F60&gt;

    def test_get_menu_access_control(self, manager):
        """Тест контроля доступа к меню"""
        # Админ получает меню
        menu = manager.get_menu("main", 123)
&gt;       assert menu is not None
E       assert None is not None

tests\test_menu_system.py:148: AssertionError</failure></testcase><testcase classname="tests.test_menu_system.TestMenuManager" name="test_current_menu_tracking" file="tests\test_menu_system.py" line="154" time="0.001" /><testcase classname="tests.test_menu_system.TestMenuManager" name="test_menu_history" file="tests\test_menu_system.py" line="169" time="0.001" /><testcase classname="tests.test_menu_system.TestMenuManager" name="test_history_limit" file="tests\test_menu_system.py" line="191" time="0.002" /><testcase classname="tests.test_menu_system.TestMenuManager" name="test_build_keyboard_simple" file="tests\test_menu_system.py" line="205" time="0.002" /><testcase classname="tests.test_menu_system.TestMenuManager" name="test_build_keyboard_with_icons" file="tests\test_menu_system.py" line="218" time="0.001" /><testcase classname="tests.test_menu_system.TestMenuManager" name="test_build_keyboard_columns" file="tests\test_menu_system.py" line="234" time="0.002" /><testcase classname="tests.test_menu_system.TestMenuManager" name="test_build_keyboard_with_back_button" file="tests\test_menu_system.py" line="248" time="0.002" /><testcase classname="tests.test_menu_system.TestMenuManager" name="test_visibility_control" file="tests\test_menu_system.py" line="265" time="0.002" /><testcase classname="tests.test_menu_system.TestMenuManager" name="test_admin_only_items" file="tests\test_menu_system.py" line="287" time="0.002" /><testcase classname="tests.test_menu_system.TestMenuManager" name="test_render_menu" file="tests\test_menu_system.py" line="312" time="0.002"><failure message="AssertionError: assert 'Бот для рассылки прайс-листов' in '❌ Меню не найдено или нет доступа'">self = &lt;tests.test_menu_system.TestMenuManager object at 0x000002B0B0B48D50&gt;, manager = &lt;menu_system.MenuManager object at 0x000002B0B2BC5BE0&gt;

    def test_render_menu(self, manager):
        """Тест рендеринга меню"""
        text, keyboard = manager.render_menu("main", 123)
    
&gt;       assert "Бот для рассылки прайс-листов" in text
E       AssertionError: assert 'Бот для рассылки прайс-листов' in '❌ Меню не найдено или нет доступа'

tests\test_menu_system.py:317: AssertionError</failure></testcase><testcase classname="tests.test_menu_system.TestMenuManager" name="test_render_nonexistent_menu" file="tests\test_menu_system.py" line="323" time="0.003" /><testcase classname="tests.test_menu_system.TestMenuManager" name="test_navigate_to" file="tests\test_menu_system.py" line="330" time="0.007"><failure message="assert False is True">self = &lt;tests.test_menu_system.TestMenuManager object at 0x000002B0B21610D0&gt;, manager = &lt;menu_system.MenuManager object at 0x000002B0B2BC55C0&gt;

    @pytest.mark.asyncio
    async def test_navigate_to(self, manager):
        """Тест навигации к меню"""
        # Мок callback query
        callback = MagicMock(spec=types.CallbackQuery)
        callback.from_user = MagicMock()
        callback.from_user.id = 123
        callback.message = MagicMock()
        callback.message.edit_text = AsyncMock()
        callback.answer = AsyncMock()
    
        # Навигация к существующему меню
        success = await manager.navigate_to("templates", callback)
    
&gt;       assert success is True
E       assert False is True

tests\test_menu_system.py:345: AssertionError</failure></testcase><testcase classname="tests.test_menu_system.TestMenuManager" name="test_navigate_to_access_denied" file="tests\test_menu_system.py" line="354" time="0.007" /><testcase classname="tests.test_menu_system.TestMenuManager" name="test_add_dynamic_menu" file="tests\test_menu_system.py" line="373" time="0.002" /><testcase classname="tests.test_menu_system.TestMenuManager" name="test_export_menu_config" file="tests\test_menu_system.py" line="398" time="0.003"><failure message="AssertionError: assert 'main' in {}">self = &lt;tests.test_menu_system.TestMenuManager object at 0x000002B0B0BC40F0&gt;, manager = &lt;menu_system.MenuManager object at 0x000002B0B2BC6DD0&gt;

    def test_export_menu_config(self, manager):
        """Тест экспорта конфигурации меню"""
        config_json = manager.export_menu_config()
        config = json.loads(config_json)
    
&gt;       assert "main" in config
E       AssertionError: assert 'main' in {}

tests\test_menu_system.py:404: AssertionError</failure></testcase><testcase classname="tests.test_menu_system.TestMenuManager" name="test_import_menu_config" file="tests\test_menu_system.py" line="418" time="0.001" /><testcase classname="tests.test_menu_system.TestMenuManager" name="test_register_callback" file="tests\test_menu_system.py" line="461" time="0.002" /><testcase classname="tests.test_menu_system.TestMenuMiddleware" name="test_middleware_adds_manager" file="tests\test_menu_system.py" line="482" time="0.004" /><testcase classname="tests.test_menu_system.TestMenuMiddleware" name="test_middleware_blocks_non_admin" file="tests\test_menu_system.py" line="497" time="0.008" /><testcase classname="tests.test_menu_system.TestMenuMiddleware" name="test_middleware_allows_admin" file="tests\test_menu_system.py" line="522" time="0.007" /><testcase classname="tests.test_menu_system.TestMenuMiddleware" name="test_middleware_allows_group_messages" file="tests\test_menu_system.py" line="545" time="0.010" /></testsuite></testsuites>