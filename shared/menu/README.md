# üèóÔ∏è –°–∏—Å—Ç–µ–º–∞ –º–µ–Ω—é –¥–ª—è Telegram –±–æ—Ç–æ–≤

–ü–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å–±–æ—Ä–∫–∏, —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –º–µ–∂–¥—É –º–µ–Ω—é –¥–ª—è aiogram –±–æ—Ç–æ–≤.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç](#-–±—ã—Å—Ç—Ä—ã–π-—Å—Ç–∞—Ä—Ç)
- [–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã](#-–æ—Å–Ω–æ–≤–Ω—ã–µ-–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã)
- [–°–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω—é](#-—Å–æ–∑–¥–∞–Ω–∏–µ-–º–µ–Ω—é)
- [–ù–∞–≤–∏–≥–∞—Ü–∏—è](#-–Ω–∞–≤–∏–≥–∞—Ü–∏—è)
- [–û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏](#-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏)
- [–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏](#-–ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ-–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏)
- [API Reference](#-api-reference)
- [–ü—Ä–∏–º–µ—Ä—ã](#-–ø—Ä–∏–º–µ—Ä—ã)

## ‚ú® –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üèóÔ∏è **–§–ª—É–µ–Ω—Ç–Ω—ã–π API** –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–µ–Ω—é
- üß≠ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è** –º–µ–∂–¥—É –º–µ–Ω—é
- üíæ **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º** –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- üîê **–ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞** (admin-only –º–µ–Ω—é/–∫–Ω–æ–ø–∫–∏)
- üì± **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–µ –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã** —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏
- üé® **–ì–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã** (CRUD, –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
- üîÑ **–ò—Å—Ç–æ—Ä–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏** —Å –∫–Ω–æ–ø–∫–æ–π "–ù–∞–∑–∞–¥"
- üéØ **–î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã** –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –∫–æ–¥–∞
- üìä **–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π** –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ –¥–∞–Ω–Ω—ã—Ö

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

```python
from menu import create_menu_system, MenuBuilder

# –°–æ–∑–¥–∞–µ–º —Å–∏—Å—Ç–µ–º—É –º–µ–Ω—é
menu_manager, menu_registry = create_menu_system([123456789])  # ID –∞–¥–º–∏–Ω–æ–≤
```

### 2. –°–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω—é

```python
# –ü—Ä–æ—Å—Ç–æ–µ –º–µ–Ω—é
main_menu = (MenuBuilder("main")
    .title("üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é")
    .description("–í—ã–±–µ—Ä–∏—Ç–µ –Ω—É–∂–Ω—ã–π —Ä–∞–∑–¥–µ–ª:")
    .add_menu_link("–ù–∞—Å—Ç—Ä–æ–π–∫–∏", "settings", "‚öôÔ∏è")
    .add_action("–ü–æ–º–æ—â—å", "help", "‚ùì")
    .no_back_button()  # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –±–µ–∑ –∫–Ω–æ–ø–∫–∏ –Ω–∞–∑–∞–¥
    .build())

# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º –º–µ–Ω—é
menu_manager.register_menu(main_menu)
```

### 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤ –∫–æ–¥–µ

```python
from aiogram import Router, types, F
from shared.menu import menu_handler

router = Router()

@router.message(CommandStart())
async def cmd_start(message: types.Message):
    """–ü–æ–∫–∞–∑–∞—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é"""
    await menu_manager.navigate_to("main", message, message.from_user.id)

@router.callback_query(F.data.startswith("menu_"))
async def handle_navigation(callback: types.CallbackQuery):
    """–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É –º–µ–Ω—é"""
    await menu_manager.handle_callback(callback)

@menu_handler(menu_manager, "help")
async def show_help(callback: types.CallbackQuery, context: dict):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–æ–º–æ—â–∏"""
    await callback.message.answer("–≠—Ç–æ —Å–ø—Ä–∞–≤–∫–∞ –ø–æ –±–æ—Ç—É!")
```

## üß© –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### MenuBuilder

–§–ª—É–µ–Ω—Ç–Ω—ã–π API –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–µ–Ω—é:

```python
menu = (MenuBuilder("menu_id")
    .title("–ó–∞–≥–æ–ª–æ–≤–æ–∫")                    # –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ–Ω—é  
    .description("–û–ø–∏—Å–∞–Ω–∏–µ")               # –û–ø–∏—Å–∞–Ω–∏–µ –ø–æ–¥ –∑–∞–≥–æ–ª–æ–≤–∫–æ–º
    .columns(2)                            # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–ª–æ–Ω–æ–∫ (1-3)
    .admin_only(True)                      # –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
    .add_action("–¢–µ–∫—Å—Ç", "callback", "üî•") # –ö–Ω–æ–ø–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è
    .add_menu_link("–ù–∞—Å—Ç—Ä–æ–π–∫–∏", "settings", "‚öôÔ∏è") # –°—Å—ã–ª–∫–∞ –Ω–∞ –º–µ–Ω—é
    .add_url("–°–∞–π—Ç", "https://example.com", "üåê")  # URL –∫–Ω–æ–ø–∫–∞
    .back_button("main")                   # –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥
    .build())
```

### MenuManager

–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–µ–π –∏ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º:

```python
# –ü–µ—Ä–µ—Ö–æ–¥ –∫ –º–µ–Ω—é
await menu_manager.navigate_to("settings", callback, user_id)

# –í–æ–∑–≤—Ä–∞—Ç –Ω–∞–∑–∞–¥
await menu_manager.go_back(callback, user_id)

# –†–∞–±–æ—Ç–∞ —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º
menu_manager.set_user_context(user_id, selected_item=123)
context = menu_manager.get_user_context(user_id)

# –¢–µ–∫—É—â–µ–µ –º–µ–Ω—é –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
current = menu_manager.get_current_menu(user_id)
```

## üèóÔ∏è –°–æ–∑–¥–∞–Ω–∏–µ –º–µ–Ω—é

### –¢–∏–ø—ã –∫–Ω–æ–ø–æ–∫

#### 1. –ö–Ω–æ–ø–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è

```python
.add_action("–°–æ–∑–¥–∞—Ç—å", "create_item", "‚ûï", admin_only=False)
```

#### 2. –°—Å—ã–ª–∫–∞ –Ω–∞ –¥—Ä—É–≥–æ–µ –º–µ–Ω—é

```python
.add_menu_link("–ù–∞—Å—Ç—Ä–æ–π–∫–∏", "settings", "‚öôÔ∏è", admin_only=True)
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç callback_data="menu_settings"
```

#### 3. URL –∫–Ω–æ–ø–∫–∞

```python
.add_url("–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è", "https://docs.example.com", "üìñ")
```

#### 4. –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ/–û—Ç–º–µ–Ω–∞

```python
.add_confirm_cancel(
    confirm_text="‚úÖ –î–∞", 
    cancel_text="‚ùå –ù–µ—Ç",
    confirm_callback="confirm_delete",
    cancel_callback="cancel_delete"
)
```

### –ì–æ—Ç–æ–≤—ã–µ —à–∞–±–ª–æ–Ω—ã

#### CRUD –º–µ–Ω—é

```python
from shared.menu import create_crud_menu

templates_menu = (create_crud_menu("templates", "–®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π")
    .add_action("–≠–∫—Å–ø–æ—Ä—Ç", "export_all", "üì§", admin_only=True)
    .build())

# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç –∫–Ω–æ–ø–∫–∏:
# ‚ûï –°–æ–∑–¥–∞—Ç—å -> templates_create
# üìã –°–ø–∏—Å–æ–∫ -> templates_list  
# ‚óÄÔ∏è –ù–∞–∑–∞–¥ -> menu_main
```

#### –ú–µ–Ω—é –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

```python
from shared.menu import create_confirmation_menu

confirm_menu = (create_confirmation_menu(
    "confirm_delete",
    "‚ö†Ô∏è –£–¥–∞–ª–∏—Ç—å —ç–ª–µ–º–µ–Ω—Ç?",
    "delete_confirmed", 
    "delete_cancelled"
).build())
```

#### –ü—Ä–æ—Å—Ç–æ–µ –º–µ–Ω—é

```python
from shared.menu import create_simple_menu

about_menu = (create_simple_menu("about", "‚ÑπÔ∏è –û –±–æ—Ç–µ", "–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –±–æ—Ç–µ")
    .add_action("–í–µ—Ä—Å–∏—è", "show_version", "üî¢")
    .add_url("GitHub", "https://github.com/user/repo", "üêô")
    .build())
```

## üß≠ –ù–∞–≤–∏–≥–∞—Ü–∏—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –ø–µ—Ä–µ—Ö–æ–¥—ã:

```python
# –í –ª—é–±–æ–º –º–µ–Ω—é –∫–Ω–æ–ø–∫–∞ —Å target_menu="settings" 
# —Å–æ–∑–¥–∞–µ—Ç callback_data="menu_settings"

@router.callback_query(F.data.startswith("menu_"))
async def handle_navigation(callback: types.CallbackQuery):
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –≤—Å–µ –ø–µ—Ä–µ—Ö–æ–¥—ã menu_* –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏"""
    success = await menu_manager.handle_callback(callback)
    if not success:
        await callback.answer("‚ùå –ú–µ–Ω—é –Ω–µ –Ω–∞–π–¥–µ–Ω–æ")
```

### –†—É—á–Ω–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è

```python
# –ü–µ—Ä–µ—Ö–æ–¥ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –º–µ–Ω—é
await menu_manager.navigate_to("settings", message, user_id)

# –° –ø–µ—Ä–µ–¥–∞—á–µ–π –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
context = {"selected_template": 123, "action": "edit"}
await menu_manager.navigate_to("templates", callback, user_id, context)

# –í–æ–∑–≤—Ä–∞—Ç –Ω–∞–∑–∞–¥
await menu_manager.go_back(callback, user_id)
```

### –ò—Å—Ç–æ—Ä–∏—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

```python
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤–µ–¥–µ—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è –¥–æ 10 –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –º–µ–Ω—é
# –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥" –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —ç—Ç—É –∏—Å—Ç–æ—Ä–∏—é

# –ü–æ–ª—É—á–∏—Ç—å –∏—Å—Ç–æ—Ä–∏—é
state = menu_manager._get_user_state(user_id)
print(f"–ò—Å—Ç–æ—Ä–∏—è: {state.history}")

# –û—á–∏—Å—Ç–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é
menu_manager.clear_navigation(user_id)
```

## üéØ –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏

### –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è callback'–æ–≤

```python
from shared.menu import menu_handler

@menu_handler(menu_manager, "help")
async def handle_help(callback: types.CallbackQuery, context: dict):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–Ω–æ–ø–∫–∏ –ø–æ–º–æ—â–∏"""
    await callback.message.answer("–°–ø—Ä–∞–≤–∫–∞ –ø–æ –±–æ—Ç—É")
    await callback.answer()

@menu_handler(menu_manager, "create_*")  # –ü–æ–¥–¥–µ—Ä–∂–∫–∞ wildcards
async def handle_create(callback: types.CallbackQuery, context: dict):
    """–û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Å–µ—Ö create_* –¥–µ–π—Å—Ç–≤–∏–π"""
    action = callback.data  # "create_template", "create_group", etc.
```

### –î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –º–µ–Ω—é

```python
from shared.menu import menu_opener

@menu_opener(menu_manager, "settings")
async def on_settings_open(target, user_id: int, context: dict):
    """–í—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫"""
    print(f"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å {user_id} –æ—Ç–∫—Ä—ã–ª –Ω–∞—Å—Ç—Ä–æ–π–∫–∏")
    
    # –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∏, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, etc.
    if context.get('is_admin'):
        print("–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –ø–æ–ª—É—á–∏–ª –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º")
```

### –†—É—á–Ω–∞—è —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

```python
async def custom_handler(callback: types.CallbackQuery, context: dict):
    await callback.message.answer("–ö–∞—Å—Ç–æ–º–Ω—ã–π –æ–±—Ä–∞–±–æ—Ç—á–∏–∫")

menu_manager.register_callback_handler("custom_action", custom_handler)
```

## üîß –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

### –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

```python
# –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –º–µ–∂–¥—É –º–µ–Ω—é
menu_manager.set_user_context(user_id, 
    selected_template=123,
    edit_mode=True,
    original_message_id=callback.message.message_id
)

# –ü–æ–ª—É—á–µ–Ω–∏–µ –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ
@menu_handler(menu_manager, "save_changes")
async def save_changes(callback: types.CallbackQuery, context: dict):
    template_id = context.get('selected_template')
    edit_mode = context.get('edit_mode', False)
    
    if edit_mode and template_id:
        # –õ–æ–≥–∏–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        pass
```

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

```python
# –ú–µ–Ω—é —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
admin_menu = (MenuBuilder("admin_panel")
    .title("üë®‚Äçüíº –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å")
    .admin_only(True)  # –í–µ—Å—å –º–µ–Ω—é —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤
    .add_action("–û–±—ã—á–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è", "normal_action")
    .add_action("–ê–¥–º–∏–Ω —Ñ—É–Ω–∫—Ü–∏—è", "admin_action", admin_only=True)  # –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –∫–Ω–æ–ø–∫–∞
    .build())
```

### –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ

```python
# –í –æ–ø–∏—Å–∞–Ω–∏–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
menu = (MenuBuilder("profile")
    .title("üë§ –ü—Ä–æ—Ñ–∏–ª—å")
    .description("–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {user_name}!\n–í–∞—à ID: {user_id}")
    .build())

# –ü—Ä–∏ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–∏ –ø–µ—Ä–µ–¥–∞—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç
context = {"user_name": "–ò–≤–∞–Ω", "user_id": 123456789}
await menu_manager.navigate_to("profile", callback, user_id, context)
```

### –ö–∞—Å—Ç–æ–º–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥

```python
def custom_renderer(menu_structure, context):
    # –ö–∞—Å—Ç–æ–º–Ω–∞—è –ª–æ–≥–∏–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
    text = f"üé® {menu_structure.config.title}\n\n–ö–∞—Å—Ç–æ–º–Ω—ã–π —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥!"
    
    # –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É
    from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton
    keyboard = InlineKeyboardMarkup(inline_keyboard=[
        [InlineKeyboardButton(text="–ö–∞—Å—Ç–æ–º–Ω–∞—è –∫–Ω–æ–ø–∫–∞", callback_data="custom")]
    ])
    
    return MenuResponse(text=text, keyboard_markup=keyboard)

# –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–µ—Ä–∞
menu_manager.renderer.register_custom_renderer("special_menu", custom_renderer)
```

### –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –º–µ–Ω—é

```python
# –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –º–µ–Ω—é –ø–æ –≥—Ä—É–ø–ø–∞–º
menu_registry.register_menu_group("features", ["templates", "groups", "mailing"])
menu_registry.register_menu_group("admin", ["settings", "logs", "backup"])
```

## üìö API Reference

### MenuBuilder

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–∞—Ä–∞–º–µ—Ç—Ä—ã |
|-------|----------|-----------|
| `title(title)` | –ó–∞–≥–æ–ª–æ–≤–æ–∫ –º–µ–Ω—é | `title: str` |
| `description(desc)` | –û–ø–∏—Å–∞–Ω–∏–µ | `desc: str` |
| `columns(count)` | –ö–æ–ª–æ–Ω–∫–∏ (1-3) | `count: int` |
| `admin_only(flag)` | –¢–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã | `flag: bool = True` |
| `add_action(text, callback, icon, admin_only)` | –ö–Ω–æ–ø–∫–∞ –¥–µ–π—Å—Ç–≤–∏—è | –°–º. –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∏–∂–µ |
| `add_menu_link(text, target, icon, admin_only)` | –°—Å—ã–ª–∫–∞ –Ω–∞ –º–µ–Ω—é | –°–º. –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∏–∂–µ |
| `add_url(text, url, icon, admin_only)` | URL –∫–Ω–æ–ø–∫–∞ | –°–º. –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∏–∂–µ |
| `add_confirm_cancel()` | –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ/–æ—Ç–º–µ–Ω–∞ | –°–º. –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –Ω–∏–∂–µ |
| `back_button(target, text)` | –ö–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥ | `target: str, text: str = "‚óÄÔ∏è –ù–∞–∑–∞–¥"` |
| `no_back_button()` | –û—Ç–∫–ª—é—á–∏—Ç—å –∫–Ω–æ–ø–∫—É –Ω–∞–∑–∞–¥ | - |
| `build()` | –°–æ–±—Ä–∞—Ç—å –º–µ–Ω—é | –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `MenuStructure` |

#### –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–Ω–æ–ø–æ–∫

- `text: str` - –¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏
- `callback/target/url: str` - –î–∞–Ω–Ω—ã–µ –∫–Ω–æ–ø–∫–∏  
- `icon: str = ""` - –ò–∫–æ–Ω–∫–∞ (—ç–º–æ–¥–∑–∏)
- `admin_only: bool = False` - –¢–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤

### MenuManager

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ |
|-------|----------|
| `register_menu(menu)` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –º–µ–Ω—é |
| `navigate_to(menu_id, target, user_id, context)` | –ü–µ—Ä–µ—Ö–æ–¥ –∫ –º–µ–Ω—é |
| `go_back(target, user_id, context)` | –í–æ–∑–≤—Ä–∞—Ç –Ω–∞–∑–∞–¥ |
| `handle_callback(callback, context)` | –û–±—Ä–∞–±–æ—Ç–∫–∞ callback |
| `get_current_menu(user_id)` | –¢–µ–∫—É—â–µ–µ –º–µ–Ω—é |
| `set_user_context(user_id, **context)` | –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç |
| `get_user_context(user_id)` | –ü–æ–ª—É—á–∏—Ç—å –∫–æ–Ω—Ç–µ–∫—Å—Ç |
| `clear_navigation(user_id)` | –û—á–∏—Å—Ç–∏—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é |

## üí° –ü—Ä–∏–º–µ—Ä—ã

### –ü–æ–ª–Ω—ã–π –ø—Ä–∏–º–µ—Ä CRUD —Å–∏—Å—Ç–µ–º—ã

```python
from aiogram import Router, types, F
from aiogram.filters import CommandStart
from aiogram.fsm.context import FSMContext
from aiogram.fsm.state import State, StatesGroup
from shared.menu import (
    create_menu_system, MenuBuilder, create_crud_menu,
    menu_handler, menu_opener
)

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
menu_manager, menu_registry = create_menu_system([123456789])
router = Router()

class TemplateStates(StatesGroup):
    waiting_name = State()
    waiting_text = State()

# === –°–û–ó–î–ê–ù–ò–ï –ú–ï–ù–Æ ===

def setup_menus():
    # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
    main_menu = (MenuBuilder("main")
        .title("üè† –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é")
        .description("Telegram Bot –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —à–∞–±–ª–æ–Ω–∞–º–∏")
        .add_menu_link("–®–∞–±–ª–æ–Ω—ã", "templates", "üìÑ")
        .add_menu_link("–ù–∞—Å—Ç—Ä–æ–π–∫–∏", "settings", "‚öôÔ∏è", admin_only=True)
        .add_action("–ü–æ–º–æ—â—å", "help", "‚ùì")
        .no_back_button()
        .build())
    
    # CRUD –º–µ–Ω—é –¥–ª—è —à–∞–±–ª–æ–Ω–æ–≤
    templates_menu = (create_crud_menu("templates", "–®–∞–±–ª–æ–Ω—ã —Å–æ–æ–±—â–µ–Ω–∏–π")
        .add_action("–≠–∫—Å–ø–æ—Ä—Ç", "export_templates", "üì§", admin_only=True)
        .build())
    
    # –ú–µ–Ω—é –Ω–∞—Å—Ç—Ä–æ–µ–∫
    settings_menu = (MenuBuilder("settings")
        .title("‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏")
        .admin_only(True)
        .add_action("–õ–æ–≥–∏", "show_logs", "üìã")
        .add_action("–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞", "show_stats", "üìä")
        .back_button("main")
        .build())
    
    # –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
    for menu in [main_menu, templates_menu, settings_menu]:
        menu_manager.register_menu(menu)

# === –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò ===

@router.message(CommandStart())
async def cmd_start(message: types.Message):
    await menu_manager.navigate_to("main", message, message.from_user.id)

@router.callback_query(F.data.startswith("menu_") | F.data == "back")
async def handle_navigation(callback: types.CallbackQuery):
    await menu_manager.handle_callback(callback)

@menu_handler(menu_manager, "help")
async def show_help(callback: types.CallbackQuery, context: dict):
    help_text = """‚ùì <b>–°–ø—Ä–∞–≤–∫–∞ –ø–æ –±–æ—Ç—É</b>

üîπ <b>–®–∞–±–ª–æ–Ω—ã</b> - —Å–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞–º–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
üîπ <b>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</b> - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –±–æ—Ç–∞ (—Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω—ã)

<b>–ö–æ–º–∞–Ω–¥—ã:</b>
/start - –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
/help - —ç—Ç–∞ —Å–ø—Ä–∞–≤–∫–∞"""
    
    await callback.message.edit_text(help_text)
    await callback.answer()

@menu_handler(menu_manager, "templates_create")
async def create_template(callback: types.CallbackQuery, state: FSMContext):
    await callback.message.edit_text(
        "‚ûï <b>–°–æ–∑–¥–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞</b>\n\n"
        "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —à–∞–±–ª–æ–Ω–∞:"
    )
    await state.set_state(TemplateStates.waiting_name)
    await callback.answer()

@router.message(TemplateStates.waiting_name)
async def process_template_name(message: types.Message, state: FSMContext):
    name = message.text.strip()
    
    if len(name) < 3:
        await message.answer("‚ùå –ù–∞–∑–≤–∞–Ω–∏–µ —Å–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–æ–µ")
        return
    
    await state.update_data(name=name)
    await message.answer(f"‚úÖ –ù–∞–∑–≤–∞–Ω–∏–µ: {name}\n\n–¢–µ–ø–µ—Ä—å –≤–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—Å—Ç —à–∞–±–ª–æ–Ω–∞:")
    await state.set_state(TemplateStates.waiting_text)

@router.message(TemplateStates.waiting_text)
async def process_template_text(message: types.Message, state: FSMContext):
    data = await state.get_data()
    
    # –ó–¥–µ—Å—å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î
    # template = await database.create_template(data['name'], message.text)
    
    await message.answer(
        f"‚úÖ <b>–®–∞–±–ª–æ–Ω —Å–æ–∑–¥–∞–Ω!</b>\n\n"
        f"üìù –ù–∞–∑–≤–∞–Ω–∏–µ: {data['name']}\n"
        f"üìÑ –¢–µ–∫—Å—Ç: {message.text[:50]}..."
    )
    
    await state.clear()
    
    # –í–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –º–µ–Ω—é —à–∞–±–ª–æ–Ω–æ–≤
    await menu_manager.navigate_to("templates", message, message.from_user.id)

@menu_opener(menu_manager, "settings")
async def on_settings_open(target, user_id: int, context: dict):
    print(f"–ê–¥–º–∏–Ω {user_id} –æ—Ç–∫—Ä—ã–ª –Ω–∞—Å—Ç—Ä–æ–π–∫–∏")

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
setup_menus()
```

### –ü—Ä–∏–º–µ—Ä —Å –ø–∞–≥–∏–Ω–∞—Ü–∏–µ–π

```python
@menu_handler(menu_manager, "templates_list")
async def show_templates_list(callback: types.CallbackQuery, context: dict):
    # –ü–æ–ª—É—á–∞–µ–º —à–∞–±–ª–æ–Ω—ã –∏–∑ –ë–î
    templates = await database.get_templates()
    page = context.get('page', 0)
    
    if not templates:
        await callback.message.edit_text(
            "üìÑ <b>–°–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤</b>\n\n‚ùå –®–∞–±–ª–æ–Ω—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã",
            reply_markup=InlineKeyboardMarkup(inline_keyboard=[
                [InlineKeyboardButton(text="‚ûï –°–æ–∑–¥–∞—Ç—å", callback_data="templates_create")],
                [InlineKeyboardButton(text="‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data="menu_templates")]
            ])
        )
        return
    
    # –ü–∞–≥–∏–Ω–∞—Ü–∏—è
    items_per_page = 5
    start = page * items_per_page
    end = start + items_per_page
    page_templates = templates[start:end]
    
    text = f"üìÑ <b>–°–ø–∏—Å–æ–∫ —à–∞–±–ª–æ–Ω–æ–≤</b>\n\nüìä –ù–∞–π–¥–µ–Ω–æ: {len(templates)}\n\n"
    
    keyboard = []
    
    # –ö–Ω–æ–ø–∫–∏ —à–∞–±–ª–æ–Ω–æ–≤
    for template in page_templates:
        icon = "üìé" if template.file_id else "üìÑ"
        keyboard.append([InlineKeyboardButton(
            text=f"{icon} {template.name}",
            callback_data=f"view_template_{template.id}"
        )])
    
    # –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
    nav_row = []
    if page > 0:
        nav_row.append(InlineKeyboardButton(
            text="‚óÄÔ∏è", callback_data=f"templates_list_page_{page-1}"
        ))
    
    if end < len(templates):
        nav_row.append(InlineKeyboardButton(
            text="‚ñ∂Ô∏è", callback_data=f"templates_list_page_{page+1}"
        ))
    
    if nav_row:
        keyboard.append(nav_row)
    
    # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
    keyboard.extend([
        [InlineKeyboardButton(text="‚ûï –°–æ–∑–¥–∞—Ç—å", callback_data="templates_create")],
        [InlineKeyboardButton(text="‚óÄÔ∏è –ù–∞–∑–∞–¥", callback_data="menu_templates")]
    ])
    
    await callback.message.edit_text(
        text, 
        reply_markup=InlineKeyboardMarkup(inline_keyboard=keyboard)
    )
    await callback.answer()

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
@menu_handler(menu_manager, "templates_list_page_*")
async def handle_templates_page(callback: types.CallbackQuery, context: dict):
    page = int(callback.data.split("_")[-1])
    context['page'] = page
    await show_templates_list(callback, context)
```

## üêõ Troubleshooting

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**1. –ú–µ–Ω—é –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è**

```python
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é –º–µ–Ω—é
if not menu_manager.has_menu("my_menu"):
    print("–ú–µ–Ω—é –Ω–µ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–æ!")

# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
menu = menu_manager.get_menu("admin_menu")
if menu.config.admin_only:
    print("–ú–µ–Ω—é —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤")
```

**2. Callback –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç—Å—è**

```python
# –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
@router.callback_query(F.data.startswith("menu_"))
async def handle_navigation(callback: types.CallbackQuery):
    success = await menu_manager.handle_callback(callback)
    if not success:
        print(f"–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π callback: {callback.data}")
```

**3. –ö–Ω–æ–ø–∫–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞—é—Ç**

```python
# –ü—Ä–æ–≤–µ—Ä—å—Ç–µ callback_data
button = MenuButton(
    text="–¢–µ—Å—Ç",
    button_type=ButtonType.ACTION,
    callback_data="test_action"  # –î–æ–ª–∂–Ω–æ –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ!
)

# –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
@menu_handler(menu_manager, "test_action")
async def handle_test(callback, context):
    await callback.answer("–†–∞–±–æ—Ç–∞–µ—Ç!")
```

### –û—Ç–ª–∞–¥–∫–∞

```python
# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Å–∏—Å—Ç–µ–º—ã –º–µ–Ω—é
stats = menu_manager.get_menu_statistics()
print(f"–ú–µ–Ω—é: {stats['total_menus']}")
print(f"–ê–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏: {stats['active_users']}")

# –°–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
state = menu_manager.export_navigation_state(user_id)
print(f"–¢–µ–∫—É—â–µ–µ –º–µ–Ω—é: {state['current_menu']}")
print(f"–ò—Å—Ç–æ—Ä–∏—è: {state['history']}")

# –°–ø–∏—Å–æ–∫ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –º–µ–Ω—é
print(f"–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ–Ω—é: {list(menu_manager._menus.keys())}")
```
